<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­ç¾ç”Ÿé†«å“¡å·¥è¨‚è³¼ç³»çµ± - Google Sheets åŒæ­¥ç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2C5F7D;
            --primary-dark: #1A3A4D;
            --accent: #E8956C;
            --accent-light: #F4C4A8;
            --bg-light: #F8F9FA;
            --bg-white: #FFFFFF;
            --text-dark: #1F2937;
            --text-gray: #6B7280;
            --border: #E5E7EB;
            --success: #10B981;
            --warning: #F59E0B;
            --shadow: rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, #E8EEF1 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 40px 20px;
            margin-bottom: 40px;
            box-shadow: 0 4px 20px var(--shadow);
            border-radius: 0 0 30px 30px;
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5em;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .subtitle {
            text-align: center;
            font-size: 1.1em;
            opacity: 0.95;
            font-weight: 300;
        }

        /* Alert Box */
        .alert {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border-left: 4px solid var(--warning);
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 12px;
            animation: fadeInUp 0.7s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert h3 {
            color: #92400E;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .alert ul {
            color: #78350F;
            margin-left: 20px;
        }

        .alert li {
            margin-bottom: 8px;
        }

        /* Setup Instructions */
        .setup-box {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px var(--shadow);
            animation: fadeInUp 0.7s ease-out 0.2s backwards;
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8em;
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--accent);
            display: inline-block;
        }

        .setup-steps {
            background: var(--bg-light);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .setup-steps ol {
            margin-left: 25px;
        }

        .setup-steps li {
            margin-bottom: 15px;
            line-height: 1.8;
        }

        .code-box {
            background: #1F2937;
            color: #F9FAFB;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .highlight {
            background: var(--accent-light);
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: var(--primary-dark);
        }

        /* Form Section */
        .order-section {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px var(--shadow);
            animation: fadeInUp 0.7s ease-out 0.4s backwards;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
            font-size: 1.05em;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1em;
            font-family: 'Noto Sans TC', sans-serif;
            transition: all 0.3s ease;
            background: var(--bg-light);
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(44, 95, 125, 0.1);
        }

        /* Category Tabs */
        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 12px 24px;
            background: var(--bg-light);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.95em;
        }

        .category-tab:hover {
            background: var(--accent-light);
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .category-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Product Grid */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .product-card {
            background: var(--bg-light);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .product-card:hover {
            border-color: var(--primary);
            box-shadow: 0 6px 20px var(--shadow);
            transform: translateY(-3px);
        }

        .product-card:hover::before {
            transform: scaleX(1);
        }

        .product-card.selected {
            border-color: var(--success);
            background: #F0FDF4;
        }

        .product-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-size: 1.05em;
        }

        .product-spec {
            color: var(--text-gray);
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .product-price {
            color: var(--accent);
            font-weight: 700;
            font-size: 1.3em;
        }

        .discount-badge {
            display: inline-block;
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 700;
            margin-top: 8px;
        }

        .discount-badge.sendon {
            background: linear-gradient(135deg, var(--warning) 0%, #D97706 100%);
        }

        .final-price {
            color: var(--success);
            font-size: 0.9em;
            margin-top: 5px;
            font-weight: 600;
        }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans TC', sans-serif;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(44, 95, 125, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(44, 95, 125, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        /* Search */
        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: var(--text-gray);
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success Message */
        .success-message {
            display: none;
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
            border-left: 4px solid var(--success);
            padding: 20px;
            margin-top: 20px;
            border-radius: 12px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .success-message.active {
            display: block;
        }

        .success-message h3 {
            color: #065F46;
            margin-bottom: 10px;
        }

        .success-message p {
            color: #047857;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .product-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .category-tabs {
                flex-direction: column;
            }
        }

        .info-box {
            background: #DBEAFE;
            border-left: 4px solid #3B82F6;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .info-box p {
            color: #1E40AF;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸ›’ ä¸­ç¾ç”Ÿé†«å“¡å·¥è¨‚è³¼ç³»çµ±</h1>
            <p class="subtitle">Google Sheets å³æ™‚åŒæ­¥ç‰ˆ | è²·ä¸€é€ä¸€å„ªæƒ </p>
        </div>
    </header>

    <div class="container">
        <!-- Discount Info Alert -->
        <div class="alert">
            <h3>ğŸ‰ å“¡è³¼å„ªæƒ èªªæ˜</h3>
            <ul>
                <li><strong>ä¸€èˆ¬ç”¢å“ï¼š</strong>è²·ä¸€é€ä¸€ï¼ˆç³»çµ±è‡ªå‹•è¨ˆç®—ï¼Œé¡¯ç¤ºå¯¦ä»˜é‡‘é¡ï¼‰</li>
                <li><strong>ä»™åŒç”¢å“ï¼š</strong>æ‰“7æŠ˜å„ªæƒ ï¼ˆç„¡è²·ä¸€é€ä¸€ï¼‰</li>
                <li>å„ªæƒ å·²è‡ªå‹•å¥—ç”¨ï¼Œæ‚¨çœ‹åˆ°çš„åƒ¹æ ¼å³ç‚ºå¯¦ä»˜åƒ¹æ ¼</li>
            </ul>
        </div>

        <!-- Setup Instructions -->
        <div class="setup-box">
            <h2 class="section-title">ğŸ“‹ Google Sheets è¨­å®šæ•™å­¸</h2>
            
            <div class="alert" style="background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%); border-left-color: #EF4444;">
                <h3 style="color: #991B1B;">âš ï¸ é‡è¦ï¼šé¦–æ¬¡ä½¿ç”¨å¿…é ˆå®Œæˆä»¥ä¸‹è¨­å®š</h3>
                <p style="color: #7F1D1D;">æ­¤ç¶²é éœ€è¦æ‚¨è‡ªè¡Œå»ºç«‹ Google Apps Script ä¾†é€£æ¥ Google Sheets</p>
            </div>

            <div class="setup-steps">
                <h3 style="margin-bottom: 15px;">è¨­å®šæ­¥é©Ÿï¼š</h3>
                <ol>
                    <li><strong>å»ºç«‹ Google Sheetï¼š</strong>
                        <ul style="margin-top: 10px;">
                            <li>å‰å¾€ Google Sheets å»ºç«‹æ–°è©¦ç®—è¡¨</li>
                            <li>åœ¨ç¬¬ä¸€åˆ—å»ºç«‹è¡¨é ­ï¼š<span class="highlight">ç”¢å“åç¨± | è¦æ ¼ | å–®åƒ¹ | æ•¸é‡ | ç¸½åƒ¹ | å‚™è¨» | ä¸‹å–®è€…</span></li>
                        </ul>
                    </li>
                    
                    <li><strong>é–‹å•Ÿ Apps Scriptï¼š</strong>
                        <ul style="margin-top: 10px;">
                            <li>åœ¨ Google Sheet ä¸­ï¼Œé»é¸ã€Œæ“´å……åŠŸèƒ½ã€â†’ã€ŒApps Scriptã€</li>
                        </ul>
                    </li>
                    
                    <li><strong>è²¼ä¸Šä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š</strong></li>
                </ol>

                <div class="code-box">
function doPost(e) {
  try {
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    var data = JSON.parse(e.postData.contents);
    
    // å°‡è³‡æ–™åŠ å…¥è©¦ç®—è¡¨
    sheet.appendRow([
      data.productName,
      data.spec,
      data.unitPrice,
      data.quantity,
      data.total,
      data.note,
      data.orderer,
      new Date() // æ™‚é–“æˆ³è¨˜
    ]);
    
    return ContentService
      .createTextOutput(JSON.stringify({
        'result': 'success',
        'message': 'è¨‚å–®å·²æ–°å¢'
      }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch(error) {
    return ContentService
      .createTextOutput(JSON.stringify({
        'result': 'error',
        'message': error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
                </div>

                <ol start="4">
                    <li><strong>éƒ¨ç½²ç‚ºç¶²è·¯æ‡‰ç”¨ç¨‹å¼ï¼š</strong>
                        <ul style="margin-top: 10px;">
                            <li>é»é¸ã€Œéƒ¨ç½²ã€â†’ã€Œæ–°å¢éƒ¨ç½²ä½œæ¥­ã€</li>
                            <li>é¡å‹é¸æ“‡ã€Œç¶²è·¯æ‡‰ç”¨ç¨‹å¼ã€</li>
                            <li>åŸ·è¡Œèº«åˆ†ï¼šé¸æ“‡ã€Œæˆ‘ã€</li>
                            <li>å…·æœ‰å­˜å–æ¬Šçš„ä½¿ç”¨è€…ï¼šé¸æ“‡ã€Œæ‰€æœ‰äººã€</li>
                            <li>é»é¸ã€Œéƒ¨ç½²ã€</li>
                        </ul>
                    </li>
                    
                    <li><strong>è¤‡è£½ç¶²å€ï¼š</strong>
                        <ul style="margin-top: 10px;">
                            <li>è¤‡è£½ã€Œç¶²è·¯æ‡‰ç”¨ç¨‹å¼ã€ç¶²å€</li>
                            <li>è²¼åˆ°ä¸‹æ–¹çš„ã€ŒApps Script URLã€æ¬„ä½</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div class="info-box">
                <p><strong>ğŸ’¡ æç¤ºï¼š</strong>å®Œæˆè¨­å®šå¾Œï¼Œæ‰€æœ‰å“¡å·¥çš„è¨‚å–®éƒ½æœƒå³æ™‚åŒæ­¥åˆ°æ‚¨çš„ Google Sheet</p>
                <p><strong>ğŸ”— åˆ†äº«æ–¹å¼ï¼š</strong>å°‡æ­¤ç¶²é æª”æ¡ˆä¸Šå‚³åˆ°æ‚¨çš„ç¶²ç«™ç©ºé–“ï¼Œæˆ–ä½¿ç”¨ GitHub Pages ç­‰å…è²»æœå‹™</p>
            </div>
        </div>

        <!-- Connection Settings -->
        <div class="order-section">
            <h2 class="section-title">ğŸ”— é€£ç·šè¨­å®š</h2>
            
            <div class="form-group">
                <label>Google Apps Script URLï¼ˆå¿…å¡«ï¼‰</label>
                <input type="text" id="scriptUrl" placeholder="è²¼ä¸Šæ‚¨çš„ Apps Script ç¶²è·¯æ‡‰ç”¨ç¨‹å¼ç¶²å€">
                <p style="color: var(--text-gray); font-size: 0.9em; margin-top: 8px;">
                    ç¯„ä¾‹ï¼šhttps://script.google.com/macros/s/YOUR_SCRIPT_ID/exec
                </p>
            </div>

            <div class="form-group">
                <label>Google Sheet é€£çµï¼ˆé¸å¡«ï¼Œæ–¹ä¾¿æŸ¥çœ‹ï¼‰</label>
                <input type="text" id="sheetUrl" placeholder="è²¼ä¸Šæ‚¨çš„ Google Sheet é€£çµ">
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="testConnection()">æ¸¬è©¦é€£ç·š</button>
                <button class="btn btn-secondary" onclick="openSheet()">é–‹å•Ÿè©¦ç®—è¡¨</button>
            </div>

            <div id="connectionStatus" class="success-message"></div>
        </div>

        <!-- Order Form -->
        <div class="order-section">
            <h2 class="section-title">ğŸ“ æ–°å¢è¨‚å–®</h2>
            
            <div class="form-group">
                <label>è¨‚è³¼äººå§“å *</label>
                <input type="text" id="employeeName" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
            </div>

            <div class="form-group">
                <label>é¸æ“‡ç”¢å“é¡åˆ¥</label>
                <div class="category-tabs">
                    <div class="category-tab active" data-category="all">å…¨éƒ¨ç”¢å“</div>
                    <div class="category-tab" data-category="è—¥æ°´">è—¥æ°´</div>
                    <div class="category-tab" data-category="è»Ÿè†">è»Ÿè†</div>
                    <div class="category-tab" data-category="éŒ åŠ‘">éŒ åŠ‘</div>
                    <div class="category-tab" data-category="å¤–è³¼">å¤–è³¼</div>
                    <div class="category-tab" data-category="è‡ªè£½é£Ÿå“">è‡ªè£½é£Ÿå“</div>
                    <div class="category-tab" data-category="ä»™åŒ">ä»™åŒ (7æŠ˜)</div>
                    <div class="category-tab" data-category="ä¸­è—¥">ä¸­è—¥</div>
                </div>
            </div>

            <div class="form-group search-box">
                <label>ğŸ” æœå°‹ç”¢å“</label>
                <input type="text" id="productSearch" placeholder="è¼¸å…¥ç”¢å“åç¨±æˆ–è¦æ ¼...">
            </div>

            <div class="form-group">
                <label>é¸æ“‡ç”¢å“ï¼ˆé»æ“Šå¡ç‰‡é¸å–ï¼‰</label>
                <div class="product-grid" id="productGrid"></div>
            </div>

            <div class="form-group">
                <label>æ•¸é‡</label>
                <input type="number" id="quantity" min="1" value="1">
            </div>

            <div class="form-group">
                <label>å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
                <input type="text" id="orderNote" placeholder="ç‰¹æ®Šéœ€æ±‚æˆ–å‚™è¨»">
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="submitOrder()" id="submitBtn">
                    æäº¤è¨‚å–®åˆ° Google Sheet
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>æ­£åœ¨æäº¤è¨‚å–®...</p>
            </div>

            <div id="orderStatus" class="success-message"></div>
        </div>
    </div>

    <script>
        // Product Database with discount info
        const products = [
            // è—¥æ°´é¡ (è²·ä¸€é€ä¸€)
            { category: "è—¥æ°´", name: "é€Ÿé”", spec: "60cc", price: 20, discount: "buy1get1" },
            { category: "è—¥æ°´", name: "é¢¨æ‹¿å¥½çˆ¾", spec: "60cc", price: 20, discount: "buy1get1" },
            { category: "è—¥æ°´", name: "è§£é¢¨å¥½", spec: "60cc", price: 20, discount: "buy1get1" },
            { category: "è—¥æ°´", name: "å—½ç†±ç—›", spec: "60cc", price: 20, discount: "buy1get1" },
            { category: "è—¥æ°´", name: "é¢¨ç†±å—½-ç„¡ç³–", spec: "60cc", price: 25, discount: "buy1get1" },

            // è»Ÿè†é¡ (è²·ä¸€é€ä¸€)
            { category: "è»Ÿè†", name: "èˆ’ç™¢", spec: "20g", price: 120, discount: "buy1get1" },
            { category: "è»Ÿè†", name: "ä¿éº—è†š", spec: "95g", price: 320, discount: "buy1get1" },
            { category: "è»Ÿè†", name: "è†šå¯§é€š", spec: "20g", price: 200, discount: "buy1get1" },
            { category: "è»Ÿè†", name: "è†šå¨œ", spec: "10g", price: 120, discount: "buy1get1" },
            { category: "è»Ÿè†", name: "æ‚ åˆ©è†š", spec: "20g", price: 200, discount: "buy1get1" },
            { category: "è»Ÿè†", name: "ä¿éº—è†šè»Ÿè†(ç«ç‘°èŠ±é¦™)", spec: "85GM/æ”¯", price: 250, discount: "buy1get1" },

            // éŒ åŠ‘é¡ (è²·ä¸€é€ä¸€)
            { category: "éŒ åŠ‘", name: "éœå’³", spec: "10T", price: 120, discount: "buy1get1" },
            { category: "éŒ åŠ‘", name: "é‚åŸºç‚ç—›", spec: "10T", price: 120, discount: "buy1get1" },
            { category: "éŒ åŠ‘", name: "ç¶­ç”Ÿç´ æ„Ÿå†’Cap", spec: "10T", price: 120, discount: "buy1get1" },
            { category: "éŒ åŠ‘", name: "å„ªç¾å­…", spec: "90T", price: 2000, discount: "buy1get1" },
            { category: "éŒ åŠ‘", name: "è§£ç™¾ç—›600mg", spec: "10T", price: 150, discount: "buy1get1" },

            // å¤–è³¼é¡ (è²·ä¸€é€ä¸€)
            { category: "å¤–è³¼", name: "å©¦ç¾æ¨‚A+", spec: "90T", price: 1000, discount: "buy1get1" },
            { category: "å¤–è³¼", name: "ç¾ä½³å¤šå£«", spec: "50T", price: 1200, discount: "buy1get1" },
            { category: "å¤–è³¼", name: "é ‚ç«‹", spec: "100T", price: 1200, discount: "buy1get1" },

            // è‡ªè£½é£Ÿå“é¡ (è²·ä¸€é€ä¸€)
            { category: "è‡ªè£½é£Ÿå“", name: "åº·å¥å–œ", spec: "60T", price: 250, discount: "buy1get1" },
            { category: "è‡ªè£½é£Ÿå“", name: "ç´…æ™¯å¤©", spec: "80T", price: 1000, discount: "buy1get1" },
            { category: "è‡ªè£½é£Ÿå“", name: "è–‘é»ƒç´…éº´", spec: "60T", price: 900, discount: "buy1get1" },

            // ä»™åŒé¡ (7æŠ˜ï¼Œç„¡è²·ä¸€é€ä¸€)
            { category: "ä»™åŒ", name: "ç†¹æ¨‚å‡ç‰™æ¸…æ½”éŒ (ç¶ èŒ¶)", spec: "48T", price: 200, discount: "sendon70" },
            { category: "ä»™åŒ", name: "ç†¹æ¨‚å‡ç‰™æ¸…æ½”éŒ (ç¶ èŒ¶)", spec: "120T", price: 420, discount: "sendon70" },
            { category: "ä»™åŒ", name: "æ—¥æœ¬è‰æœ¬ç‰™è†", spec: "100g", price: 280, discount: "sendon70" },
            { category: "ä»™åŒ", name: "L8020æ¼±å£æ°´", spec: "500ml", price: 280, discount: "sendon70" },
            { category: "ä»™åŒ", name: "å‡ç‰™æµ¸æ³¡ç›’", spec: "", price: 120, discount: "sendon70" },
            { category: "ä»™åŒ", name: "é€€ç†±è²¼", spec: "2å…¥*4åŒ…", price: 180, discount: "sendon70" },
            { category: "ä»™åŒ", name: "æš–æš–åŒ…", spec: "10å…¥", price: 120, discount: "sendon70" },
            { category: "ä»™åŒ", name: "ä¾¿é€šæ¨‚ç”˜æ²¹æµ£è…¸æ¶²", spec: "10ç²’", price: 65, discount: "sendon70" },
            { category: "ä»™åŒ", name: "æ–½ç¾éœ²çœ¼è—¥æ°´", spec: "16ml", price: 150, discount: "sendon70" },
            { category: "ä»™åŒ", name: "è²¼åˆ©è†šé˜²æ°´ä¿è­·è†œ(å™´éœ§)", spec: "50ml", price: 500, discount: "sendon70" },
            { category: "ä»™åŒ", name: "è²¼åˆ©è†šç–¤ç—•å‡è† ", spec: "8g", price: 800, discount: "sendon70" },
            { category: "ä»™åŒ", name: "è²¼åˆ©è†šæ•·æ–™(äººå·¥çš®)", spec: "5*20cm", price: 100, discount: "sendon70" },
            { category: "ä»™åŒ", name: "è²¼åˆ©è†šæ•·æ–™(äººå·¥çš®)", spec: "10*10cm", price: 100, discount: "sendon70" },

            // ä¸­è—¥é¡ (è²·ä¸€é€ä¸€)
            { category: "ä¸­è—¥", name: "é»ƒé€£è§£æ¯’ä¸¸", spec: "250T", price: 1000, discount: "buy1get1" },
            { category: "ä¸­è—¥", name: "æ¶ˆç—”ä¸¸", spec: "250T", price: 1000, discount: "buy1get1" },
            { category: "ä¸­è—¥", name: "éˆç›®ä¸¸", spec: "250T", price: 1000, discount: "buy1get1" },
        ];

        let currentCategory = 'all';
        let selectedProduct = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderProducts();
            setupEventListeners();
            loadSettings();
        });

        function setupEventListeners() {
            // Category tabs
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentCategory = this.dataset.category;
                    renderProducts();
                });
            });

            // Product search
            document.getElementById('productSearch').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                renderProducts(searchTerm);
            });

            // Save settings
            document.getElementById('scriptUrl').addEventListener('change', saveSettings);
            document.getElementById('sheetUrl').addEventListener('change', saveSettings);
        }

        function calculateFinalPrice(product, quantity) {
            if (product.discount === 'buy1get1') {
                // è²·ä¸€é€ä¸€ï¼šæ¯2å€‹åªç®—1å€‹çš„åƒ¹éŒ¢
                const pairs = Math.floor(quantity / 2);
                const remainder = quantity % 2;
                return (pairs + remainder) * product.price;
            } else if (product.discount === 'sendon70') {
                // 7æŠ˜
                return Math.round(product.price * quantity * 0.7);
            }
            return product.price * quantity;
        }

        function renderProducts(searchTerm = '') {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';

            let filteredProducts = products;

            // Filter by category
            if (currentCategory !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.category === currentCategory);
            }

            // Filter by search term
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) ||
                    p.spec.toLowerCase().includes(searchTerm)
                );
            }

            filteredProducts.forEach((product, index) => {
                const sampleQty = 1;
                const finalPrice = calculateFinalPrice(product, sampleQty);
                
                const card = document.createElement('div');
                card.className = 'product-card';
                if (selectedProduct && selectedProduct.name === product.name && selectedProduct.spec === product.spec) {
                    card.classList.add('selected');
                }

                let discountBadgeHTML = '';
                let finalPriceHTML = '';
                
                if (product.discount === 'buy1get1') {
                    discountBadgeHTML = '<div class="discount-badge">è²·ä¸€é€ä¸€</div>';
                    finalPriceHTML = `<div class="final-price">å¯¦ä»˜ï¼šNT$ ${finalPrice}/å€‹</div>`;
                } else if (product.discount === 'sendon70') {
                    discountBadgeHTML = '<div class="discount-badge sendon">ä»™åŒ7æŠ˜</div>';
                    finalPriceHTML = `<div class="final-price">å„ªæƒ åƒ¹ï¼šNT$ ${finalPrice}</div>`;
                }

                card.innerHTML = `
                    <div class="product-name">${product.name}</div>
                    <div class="product-spec">${product.spec}</div>
                    <div class="product-price">åŸåƒ¹ NT$ ${product.price}</div>
                    ${finalPriceHTML}
                    ${discountBadgeHTML}
                `;
                
                card.addEventListener('click', () => selectProduct(product));
                grid.appendChild(card);
            });
        }

        function selectProduct(product) {
            selectedProduct = product;
            renderProducts(document.getElementById('productSearch').value);
        }

        function saveSettings() {
            const scriptUrl = document.getElementById('scriptUrl').value;
            const sheetUrl = document.getElementById('sheetUrl').value;
            localStorage.setItem('scriptUrl', scriptUrl);
            localStorage.setItem('sheetUrl', sheetUrl);
        }

        function loadSettings() {
            const scriptUrl = localStorage.getItem('scriptUrl');
            const sheetUrl = localStorage.getItem('sheetUrl');
            if (scriptUrl) document.getElementById('scriptUrl').value = scriptUrl;
            if (sheetUrl) document.getElementById('sheetUrl').value = sheetUrl;
        }

        function testConnection() {
            const scriptUrl = document.getElementById('scriptUrl').value.trim();
            if (!scriptUrl) {
                alert('è«‹å…ˆè¼¸å…¥ Google Apps Script URL');
                return;
            }

            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.innerHTML = '<h3>ğŸ”„ æ¸¬è©¦é€£ç·šä¸­...</h3><p>è«‹ç¨å€™...</p>';
            statusDiv.classList.add('active');

            // Test connection with dummy data
            fetch(scriptUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    productName: 'æ¸¬è©¦é€£ç·š',
                    spec: 'TEST',
                    unitPrice: 0,
                    quantity: 0,
                    total: 0,
                    note: 'é€™æ˜¯æ¸¬è©¦è¨‚å–®ï¼Œå¯ä»¥åˆªé™¤',
                    orderer: 'ç³»çµ±æ¸¬è©¦'
                })
            }).then(() => {
                statusDiv.innerHTML = '<h3>âœ… é€£ç·šæˆåŠŸï¼</h3><p>æ‚¨çš„ Google Sheet è¨­å®šæ­£ç¢ºï¼Œå¯ä»¥é–‹å§‹ä½¿ç”¨äº†ã€‚</p>';
            }).catch(error => {
                statusDiv.innerHTML = '<h3>âŒ é€£ç·šå¤±æ•—</h3><p>è«‹æª¢æŸ¥æ‚¨çš„ Apps Script URL æ˜¯å¦æ­£ç¢ºï¼Œä¸¦ç¢ºèªå·²æ­£ç¢ºéƒ¨ç½²ã€‚</p>';
                statusDiv.style.background = 'linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%)';
                statusDiv.style.borderLeftColor = '#EF4444';
            });
        }

        function openSheet() {
            const sheetUrl = document.getElementById('sheetUrl').value.trim();
            if (!sheetUrl) {
                alert('è«‹å…ˆè¼¸å…¥ Google Sheet é€£çµ');
                return;
            }
            window.open(sheetUrl, '_blank');
        }

        async function submitOrder() {
            const scriptUrl = document.getElementById('scriptUrl').value.trim();
            const employeeName = document.getElementById('employeeName').value.trim();
            const quantity = parseInt(document.getElementById('quantity').value);
            const orderNote = document.getElementById('orderNote').value.trim();

            // Validation
            if (!scriptUrl) {
                alert('è«‹å…ˆè¨­å®š Google Apps Script URL');
                document.getElementById('scriptUrl').focus();
                return;
            }

            if (!employeeName) {
                alert('è«‹è¼¸å…¥è¨‚è³¼äººå§“å');
                document.getElementById('employeeName').focus();
                return;
            }

            if (!selectedProduct) {
                alert('è«‹é¸æ“‡ç”¢å“');
                return;
            }

            if (!quantity || quantity < 1) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆæ•¸é‡');
                return;
            }

            // Calculate final price
            const finalTotal = calculateFinalPrice(selectedProduct, quantity);

            // Show loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('submitBtn').disabled = true;

            // Prepare data
            const orderData = {
                productName: selectedProduct.name,
                spec: selectedProduct.spec,
                unitPrice: selectedProduct.price,
                quantity: quantity,
                total: finalTotal,
                note: `${orderNote} | ${selectedProduct.discount === 'buy1get1' ? 'è²·ä¸€é€ä¸€' : 'ä»™åŒ7æŠ˜'}`,
                orderer: employeeName
            };

            try {
                const response = await fetch(scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });

                // Show success message
                const statusDiv = document.getElementById('orderStatus');
                statusDiv.innerHTML = `
                    <h3>âœ… è¨‚å–®æäº¤æˆåŠŸï¼</h3>
                    <p><strong>${selectedProduct.name}</strong> x ${quantity}</p>
                    <p>å¯¦ä»˜é‡‘é¡ï¼šNT$ ${finalTotal}</p>
                    <p>è¨‚å–®å·²åŒæ­¥åˆ° Google Sheet</p>
                `;
                statusDiv.classList.add('active');

                // Reset form
                document.getElementById('quantity').value = 1;
                document.getElementById('orderNote').value = '';
                selectedProduct = null;
                renderProducts();

                // Hide success message after 5 seconds
                setTimeout(() => {
                    statusDiv.classList.remove('active');
                }, 5000);

            } catch (error) {
                alert('æäº¤å¤±æ•—ï¼š' + error.message);
            } finally {
                document.getElementById('loading').classList.remove('active');
                document.getElementById('submitBtn').disabled = false;
            }
        }
    </script>
</body>
</html>
