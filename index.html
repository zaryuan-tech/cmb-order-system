<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­ç¾ç”Ÿé†«å“¡å·¥è¨‚è³¼ç³»çµ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2C5F7D;
            --primary-dark: #1A3A4D;
            --accent: #E8956C;
            --accent-light: #F4C4A8;
            --bg-light: #F8F9FA;
            --bg-white: #FFFFFF;
            --text-dark: #1F2937;
            --text-gray: #6B7280;
            --border: #E5E7EB;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --shadow: rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, #E8EEF1 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 100px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 30px 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px var(--shadow);
            border-radius: 0 0 30px 30px;
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.2em;
            font-weight: 700;
            text-align: center;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }

        .subtitle {
            text-align: center;
            font-size: 1em;
            opacity: 0.95;
            font-weight: 300;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
        }

        .product-section,
        .cart-section {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px var(--shadow);
            animation: fadeInUp 0.7s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.6em;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid var(--accent);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
            font-size: 1.05em;
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1em;
            font-family: 'Noto Sans TC', sans-serif;
            transition: all 0.3s ease;
            background: var(--bg-light);
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(44, 95, 125, 0.1);
        }

        .category-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 18px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 8px 16px;
            background: var(--bg-light);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.9em;
        }

        .category-tab:hover {
            background: var(--accent-light);
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .category-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
            background: var(--bg-light);
            border-radius: 12px;
        }

        .product-grid::-webkit-scrollbar {
            width: 8px;
        }

        .product-grid::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .product-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .product-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 15px var(--shadow);
            transform: translateY(-2px);
        }

        .product-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
            font-size: 1em;
        }

        .product-spec {
            color: var(--text-gray);
            font-size: 0.85em;
            margin-bottom: 6px;
        }

        .product-price {
            color: var(--accent);
            font-weight: 700;
            font-size: 1.1em;
        }

        .discount-badge {
            display: inline-block;
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            color: white;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 0.65em;
            font-weight: 700;
            margin-top: 4px;
        }

        .discount-badge.sendon {
            background: linear-gradient(135deg, var(--warning) 0%, #D97706 100%);
        }

        .final-price {
            color: var(--success);
            font-size: 0.8em;
            margin-top: 3px;
            font-weight: 600;
        }

        .cart-section {
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .cart-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-gray);
        }

        .cart-items {
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .cart-item {
            background: var(--bg-light);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            position: relative;
        }

        .cart-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 8px;
        }

        .cart-item-name {
            font-weight: 600;
            color: var(--text-dark);
            flex: 1;
            font-size: 0.95em;
        }

        .cart-item-remove {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            margin-left: 8px;
        }

        .cart-item-remove:hover {
            transform: scale(1.1);
            background: #DC2626;
        }

        .cart-item-details {
            font-size: 0.85em;
            color: var(--text-gray);
            margin-bottom: 6px;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .qty-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .qty-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .qty-display {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
        }

        .cart-item-price {
            text-align: right;
            font-weight: 700;
            color: var(--success);
            font-size: 1.05em;
            margin-top: 6px;
        }

        .cart-summary {
            border-top: 2px solid var(--border);
            padding-top: 15px;
            margin-top: 15px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .summary-row.total {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--primary);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid var(--border);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans TC', sans-serif;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(44, 95, 125, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(44, 95, 125, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #DC2626;
            transform: translateY(-2px);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 15px;
            color: var(--text-gray);
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 35px;
            height: 35px;
            animation: spin 1s linear infinite;
            margin: 0 auto 8px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .alert {
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
            border-left: 4px solid var(--success);
            padding: 15px;
            margin-top: 15px;
            border-radius: 10px;
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert.active {
            display: block;
        }

        .alert.error {
            background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
            border-left-color: var(--danger);
        }

        .alert h4 {
            margin-bottom: 6px;
            font-size: 1.05em;
        }

        .required {
            color: var(--danger);
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .cart-section {
                position: relative;
                top: 0;
                max-height: none;
            }

            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸ›’ ä¸­ç¾ç”Ÿé†«å“¡å·¥è¨‚è³¼ç³»çµ±</h1>
            <p class="subtitle">è²·ä¸€é€ä¸€å„ªæƒ  | ä»™åŒç”¢å“7æŠ˜ | 156é …ç”¢å“</p>
        </div>
    </header>

    <div class="container">
        <div class="main-grid">
            <div class="product-section">
                <h2 class="section-title">ğŸ“¦ ç”¢å“é¸æ“‡</h2>

                <div class="form-group">
                    <label>é¸æ“‡ç”¢å“é¡åˆ¥</label>
                    <div class="category-tabs">
                        <div class="category-tab active" data-category="all">å…¨éƒ¨</div>
                        <div class="category-tab" data-category="è—¥æ°´">è—¥æ°´</div>
                        <div class="category-tab" data-category="è»Ÿè†">è»Ÿè†</div>
                        <div class="category-tab" data-category="éŒ åŠ‘">éŒ åŠ‘</div>
                        <div class="category-tab" data-category="å¤–è³¼">å¤–è³¼</div>
                        <div class="category-tab" data-category="è‡ªè£½é£Ÿå“">è‡ªè£½é£Ÿå“</div>
                        <div class="category-tab" data-category="ä»™åŒ">ä»™åŒ(7æŠ˜)</div>
                        <div class="category-tab" data-category="ä¸­è—¥">ä¸­è—¥</div>
                        <div class="category-tab" data-category="ä¸­ç¾ç”Ÿé†«">ä¸­ç¾ç”Ÿé†«</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>ğŸ” æœå°‹ç”¢å“</label>
                    <input type="text" id="productSearch" placeholder="è¼¸å…¥ç”¢å“åç¨±æˆ–è¦æ ¼...">
                </div>

                <div class="product-grid" id="productGrid"></div>
            </div>

            <div class="cart-section">
                <h2 class="section-title">ğŸ›ï¸ è³¼ç‰©è»Š</h2>

                <div class="form-group">
                    <label>è¨‚è³¼äººå§“å <span class="required">*</span></label>
                    <input type="text" id="employeeName" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
                </div>

                <div id="cartContent">
                    <div class="cart-empty">
                        <p>ğŸ›’ è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>
                        <p style="font-size: 0.9em; margin-top: 8px;">é»æ“Šå·¦å´ç”¢å“åŠ å…¥è³¼ç‰©è»Š</p>
                    </div>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨æäº¤è¨‚å–®...</p>
                </div>

                <div id="alertBox" class="alert"></div>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxM050Qq3lYlch874tC6_F0Pr3U7sNxLiJvUTSlM0-nMy7xAQDHLCrodArgfDvQyNMWjg/exec';
        
        const products = [{category:"è—¥æ°´",name:"é€Ÿé”",spec:"60cc",price:20,discount:"buy1get1"},{category:"è—¥æ°´",name:"é¢¨æ‹¿å¥½çˆ¾",spec:"60cc",price:20,discount:"buy1get1"},{category:"è—¥æ°´",name:"è§£é¢¨å¥½",spec:"60cc",price:20,discount:"buy1get1"},{category:"è—¥æ°´",name:"å—½ç†±ç—›",spec:"60cc",price:20,discount:"buy1get1"},{category:"è—¥æ°´",name:"é¢¨ç†±å—½-ç„¡ç³–",spec:"60cc",price:25,discount:"buy1get1"},{category:"è»Ÿè†",name:"èˆ’ç™¢",spec:"20g",price:120,discount:"buy1get1"},{category:"è»Ÿè†",name:"ä¿éº—è†š",spec:"95g",price:320,discount:"buy1get1"},{category:"è»Ÿè†",name:"è†šå¯§é€š",spec:"20g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"è†šå¨œ",spec:"10g",price:120,discount:"buy1get1"},{category:"è»Ÿè†",name:"æ‚ åˆ©è†š",spec:"20g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"åº·æ·¨è†š",spec:"15g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"çš®æ„›æ½”",spec:"20g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"æ„›æ½”è†š",spec:"10g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"çš®ç«‹æ½”",spec:"15g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"èˆ’åº–æ¨‚",spec:"6g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"ç¾å£çˆ¾",spec:"5g",price:150,discount:"buy1get1"},{category:"è»Ÿè†",name:"å„ªå«©",spec:"15g",price:250,discount:"buy1get1"},{category:"è»Ÿè†",name:"æ„›æ½”ä¹³è†",spec:"20g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"ç–¤è†šåŠ›",spec:"15g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"æ¯è…«ç—›",spec:"30g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"ç¼åˆ¥æ‚¨",spec:"25g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"åŒ–é»´ä¹³è†",spec:"20g",price:250,discount:"buy1get1"},{category:"è»Ÿè†",name:"ç—”çˆ½",spec:"25g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"é®®è†šåŠ›",spec:"20g",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"åˆ©ç”²åº·",spec:"7.5ml",price:1800,discount:"buy1get1"},{category:"è»Ÿè†",name:"åˆ©ç”²åº·-ç«ç‘°",spec:"3ml",price:1000,discount:"buy1get1"},{category:"è»Ÿè†",name:"è³€çˆ¾çˆ½",spec:"50cc",price:250,discount:"buy1get1"},{category:"è»Ÿè†",name:"é¼»é‚£é€š",spec:"20cc",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"ä¼æ‚¨ç‚",spec:"32ml",price:280,discount:"buy1get1"},{category:"è»Ÿè†",name:"ä¼æ‚¨ç‚-è‰è“",spec:"32ml",price:280,discount:"buy1get1"},{category:"è»Ÿè†",name:"ç‚ç«‹åœ",spec:"15ml",price:300,discount:"buy1get1"},{category:"è»Ÿè†",name:"èˆ’ç­‹æ¨‚å™´åŠ‘",spec:"120cc",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"è†šè«¾ç—›",spec:"100ml",price:180,discount:"buy1get1"},{category:"è»Ÿè†",name:"å‘¼å‘¼å¤–ç”¨æ¶²",spec:"36cc",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"æ‚ ç¾è†š",spec:"360ML",price:450,discount:"buy1get1"},{category:"è»Ÿè†",name:"ç‰¹å€çœ¼èˆ’",spec:"5ML",price:150,discount:"buy1get1"},{category:"è»Ÿè†",name:"èˆ’æ·¨æ´—é«®ç²¾",spec:"140g",price:300,discount:"buy1get1"},{category:"è»Ÿè†",name:"æ·¨çµ²æ„‰æ´—é«®ç²¾",spec:"150g",price:400,discount:"buy1get1"},{category:"è»Ÿè†",name:"ä¿éº—è†šè»Ÿè†(ç«ç‘°èŠ±é¦™)",spec:"85GM/æ”¯",price:250,discount:"buy1get1"},{category:"è»Ÿè†",name:"æ„›æ½”è†šä¹³è†(ç‘å©·ç¾…)",spec:"5G/ç›’",price:120,discount:"buy1get1"},{category:"è»Ÿè†",name:"æ½”èŠ™æ¨‚ä¹³è†",spec:"20G/ç›’",price:220,discount:"buy1get1"},{category:"è»Ÿè†",name:"å¦¥æ¨‚é»´ä¹³è†",spec:"20G/ç›’",price:250,discount:"buy1get1"},{category:"è»Ÿè†",name:"æ¨‚ç–±æ¶ˆä¹³è†",spec:"6g/æ”¯",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"å‘¼å‘¼å¤–ç”¨æ¶²(ç¶ èŒ¶)",spec:"32ML/ç›’",price:220,discount:"buy1get1"},{category:"è»Ÿè†",name:"è‰¾é«®æ·¨è—¥ç”¨æ´—é«®æ¶²",spec:"150G/ç“¶",price:400,discount:"buy1get1"},{category:"è»Ÿè†",name:"è†šè«¾ç—›å¤–ç”¨æ¶²",spec:"75ML/ç›’",price:150,discount:"buy1get1"},{category:"è»Ÿè†",name:"é¼»èˆ’åº·å™´é¼»æ¶²",spec:"20ML/ç›’",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"åˆ©ç”²åº·æŠ—ç”²ç™¬æ²¹åŠ‘(èŠ±é¦™)",spec:"3.5ML/ç›’",price:1050,discount:"buy1get1"},{category:"è»Ÿè†",name:"ç¾å£çˆ¾å£å…§è†(å“ˆèœœç“œå‘³)",spec:"5G/ç›’",price:160,discount:"buy1get1"},{category:"è»Ÿè†",name:"ä¼æ‚¨ç‚å£è…”æ¶ˆç‚å™´åŠ‘(è‘¡è„å‘³)",spec:"28ML/ç›’",price:270,discount:"buy1get1"},{category:"è»Ÿè†",name:"ç¥›é»´é€Ÿä¹³è†",spec:"20G/ç›’",price:200,discount:"buy1get1"},{category:"è»Ÿè†",name:"è†šç‚æ¶ˆé»´ç´ è»Ÿè†",spec:"22G/ç›’",price:220,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"éœå’³",spec:"10T",price:120,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"é‚åŸºç‚ç—›",spec:"10T",price:120,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"ç¶­ç”Ÿç´ æ„Ÿå†’Cap",spec:"10T",price:120,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"æ„Ÿå†’é€Ÿé”PTP",spec:"10T",price:120,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"å¯è­·å¿ƒæ„Ÿå†’Cap",spec:"10T",price:100,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"å…‹ç—¢",spec:"10T",price:100,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"è„ˆäº¦é€š",spec:"60T",price:600,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"æ—…ä½³éŒ ",spec:"10T",price:100,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"é¡§çˆ¾è‚150mg",spec:"100T",price:1000,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"é†«å¦³ç—›",spec:"10T",price:100,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"èˆ’é”åŠ å¼·éŒ ",spec:"10T",price:120,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"è¡€å¹³ä½³",spec:"30T",price:500,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"èˆ’é”èƒƒ",spec:"4åŒ…/ç›’",price:150,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"èˆ’èƒƒå› éŒ ",spec:"20T",price:100,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"å–‰çˆ¾çˆ½",spec:"20T",price:150,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"æ•æ‹¿å¥½çˆ¾",spec:"20T",price:200,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"ä¾¿é€šä¾¿",spec:"20T",price:150,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"ä¾¿é€šæ¨‚",spec:"20T",price:100,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"å„ªç¾å­…",spec:"6T",price:180,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"å„ªç¾å­…",spec:"90T",price:2000,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"æ´›ç–¼",spec:"10T",price:100,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"éœå®‰èƒ½",spec:"20T",price:350,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"è§£ç™¾ç—›",spec:"10T",price:100,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"è§£ç™¾ç—›600mg",spec:"10T",price:150,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"ä¼ç­‹å¯§",spec:"10T",price:120,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"å„ªç¾å­…æ²¹åˆ‡è† å›Š",spec:"6ç²’/ç›’",price:200,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"å„ªç¾å­…æ²¹åˆ‡è† å›Š",spec:"63ç²’/ç›’",price:1480,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"èˆ’ç—›ä½³éŒ ",spec:"10ç²’/ç›’",price:120,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"è§£ç—›å¯§è†œè¡£éŒ 400",spec:"10éŒ /æ”¯",price:100,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"è§£ç—›å¯§è†œè¡£éŒ 600",spec:"10éŒ /æ”¯",price:150,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"éœå®‰èƒ½è† å›Š",spec:"10ç²’/ç›’",price:200,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"æ„Ÿå†’å„ªç¶­ç”Ÿç´ è† å›Š",spec:"9ç²’/ç›’",price:120,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"ä¸­ç¾ä¾¿é€šæ¨‚è†œè¡£éŒ ",spec:"20ç²’/ç›’",price:108,discount:"buy1get1"},{category:"éŒ åŠ‘",name:"ä¸­ç¾å–œå–‰æ·¨å£å«éŒ ",spec:"20ç²’/ç›’",price:120,discount:"buy1get1"},{category:"å¤–è³¼",name:"å©¦ç¾æ¨‚A+",spec:"90T",price:1000,discount:"buy1get1"},{category:"å¤–è³¼",name:"ç¾ä½³å¤šå£«",spec:"50T",price:1200,discount:"buy1get1"},{category:"å¤–è³¼",name:"è°·åŠ›å„ªA+é€Ÿæº¶",spec:"60T",price:1000,discount:"buy1get1"},{category:"å¤–è³¼",name:"é€Ÿç«‹æŒºè¤‡åˆéˆ£",spec:"100T",price:700,discount:"buy1get1"},{category:"å¤–è³¼",name:"æ¤ç‰©æ€§å‡è† ",spec:"40g",price:350,discount:"buy1get1"},{category:"å¤–è³¼",name:"è­·å¦³æ½”",spec:"300ml",price:500,discount:"buy1get1"},{category:"å¤–è³¼",name:"ç¾æ±æ “åŠ‘",spec:"5T",price:180,discount:"buy1get1"},{category:"å¤–è³¼",name:"ä¸­ç¾è¬éˆè†",spec:"4ç‰‡",price:100,discount:"buy1get1"},{category:"å¤–è³¼",name:"èˆ’ç­‹æ¨‚è²¼å¸ƒ",spec:"5ç‰‡",price:150,discount:"buy1get1"},{category:"å¤–è³¼",name:"é†«æ‚¨ç—›è²¼å¸ƒ",spec:"5ç‰‡",price:100,discount:"buy1get1"},{category:"å¤–è³¼",name:"é ‚ç«‹",spec:"100T",price:1200,discount:"buy1get1"},{category:"å¤–è³¼",name:"ç™¾é©åº·",spec:"90T",price:1000,discount:"buy1get1"},{category:"å¤–è³¼",name:"æ”åˆ©å¨",spec:"60T",price:1200,discount:"buy1get1"},{category:"å¤–è³¼",name:"ç™¾èˆ’ä½³",spec:"60T",price:1000,discount:"buy1get1"},{category:"å¤–è³¼",name:"ç¦¾ç«‹é ‚",spec:"4T",price:900,discount:"buy1get1"},{category:"å¤–è³¼",name:"ç¾è¦–æ¨‚",spec:"10ml",price:130,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"åº·å¥å–œ",spec:"60T",price:250,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"ç´…æ™¯å¤©",spec:"80T",price:1000,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"å€èºBç¾¤è† å›Š",spec:"90T",price:800,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"æ‚…å¿…æ¨‚",spec:"30T",price:980,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"è–‘é»ƒç´…éº´",spec:"60T",price:900,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"ç¶­ç”Ÿç´ B12+è‘‰é…¸",spec:"50T",price:900,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"ç¾å£å¥B2B6ç·©é‡‹éŒ ",spec:"14T",price:200,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"å¾—åº·è¡›é€Ÿæº¶éŒ ",spec:"60T",price:650,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"ç«‹æ¸…çˆ½",spec:"30åŒ…",price:750,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"ç¶œåˆç¶­ç”Ÿç´ Dé…æ–¹",spec:"60ç²’",price:1000,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"å·¦æ—‹éº©é†¯èƒºé…¸é‹…é…æ–¹",spec:"21GM/åŒ…,14åŒ…",price:2100,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"æ•æ¨‚å„ªæ©Ÿèƒ½ç›Šç”ŸèŒ",spec:"30åŒ…/æ”¯",price:900,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"ç›®æ¼¾é‡‘ç›èŠ±è‘‰é»ƒç´ ç·©é‡‹éŒ ",spec:"60ç²’/æ”¯",price:1000,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"è£œé‹…éŒ ",spec:"120T",price:500,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"ç¾ä»™æ¥µæ¾±éŒ ",spec:"42'S/æ”¯",price:500,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"é‡‘å›ºé—œå¥UC-IIç·©é‡‹éŒ ",spec:"60/æ”¯",price:1500,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"èšŠé¿",spec:"100ml",price:250,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"æ¨‚å£èˆ’B2B6ç·©é‡‹éŒ ",spec:"14éŒ /ç“¶",price:200,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"æ¨‚å£èˆ’B2B6ç·©é‡‹éŒ ",spec:"32éŒ /ç“¶",price:400,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"æ¥µæ¾±å°ç­–éŒ ",spec:"36éŒ /ç“¶",price:500,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"æ¥µæ¾±å°ç­–éŒ ",spec:"90éŒ /ç“¶",price:900,discount:"buy1get1"},{category:"è‡ªè£½é£Ÿå“",name:"èšŠé¿é˜²èšŠæ¶²",spec:"75ML/ç›’",price:220,discount:"buy1get1"},{category:"ä»™åŒ",name:"ç†¹æ¨‚å‡ç‰™æ¸…æ½”éŒ (ç¶ èŒ¶)",spec:"48T",price:200,discount:"sendon70"},{category:"ä»™åŒ",name:"ç†¹æ¨‚å‡ç‰™æ¸…æ½”éŒ (ç¶ èŒ¶)",spec:"120T",price:420,discount:"sendon70"},{category:"ä»™åŒ",name:"æ—¥æœ¬è‰æœ¬ç‰™è†",spec:"100g",price:280,discount:"sendon70"},{category:"ä»™åŒ",name:"L8020æ¼±å£æ°´",spec:"500ml",price:280,discount:"sendon70"},{category:"ä»™åŒ",name:"å‡ç‰™æµ¸æ³¡ç›’",spec:"",price:120,discount:"sendon70"},{category:"ä»™åŒ",name:"é€€ç†±è²¼",spec:"2å…¥*4åŒ…",price:180,discount:"sendon70"},{category:"ä»™åŒ",name:"æš–æš–åŒ…",spec:"10å…¥",price:120,discount:"sendon70"},{category:"ä»™åŒ",name:"ä¾¿é€šæ¨‚ç”˜æ²¹æµ£è…¸æ¶²",spec:"10ç²’",price:65,discount:"sendon70"},{category:"ä»™åŒ",name:"æ–½ç¾éœ²çœ¼è—¥æ°´",spec:"16ml",price:150,discount:"sendon70"},{category:"ä»™åŒ",name:"è²¼åˆ©è†šé˜²æ°´ä¿è­·è†œ(å™´éœ§)",spec:"50ml",price:500,discount:"sendon70"},{category:"ä»™åŒ",name:"è²¼åˆ©è†šç–¤ç—•å‡è† ",spec:"8g",price:800,discount:"sendon70"},{category:"ä»™åŒ",name:"è²¼åˆ©è†šæ•·æ–™(äººå·¥çš®)",spec:"5*20cm",price:100,discount:"sendon70"},{category:"ä»™åŒ",name:"è²¼åˆ©è†šæ•·æ–™(äººå·¥çš®)",spec:"10*10cm",price:100,discount:"sendon70"},{category:"ä»™åŒ",name:"ä¸­ç¾ç”Ÿé†«å‡ç‰™æ¸…æ½”éŒ (ç¶ èŒ¶)",spec:"72ç²’/ç›’",price:280,discount:"sendon70"},{category:"ä»™åŒ",name:"L-8020ç¾å£æ½”ä¹³é…¸èŒæ¼±å£æ°´(è–„è·)",spec:"500ML",price:299,discount:"sendon70"},{category:"ä»™åŒ",name:"Teryleafç¾å£æ½”è‰æœ¬ç‰™è†",spec:"100G/ç›’",price:280,discount:"sendon70"},{category:"ä»™åŒ",name:"ç…ä¹‹æ–½ç¾éœ²çœ¼è—¥æ°´",spec:"16ML",price:150,discount:"sendon70"},{category:"ä»™åŒ",name:"ä»™åŒé€€ç†±è²¼",spec:"2ç‰‡/åŒ… 4åŒ…/ç›’",price:180,discount:"sendon70"},{category:"ä¸­è—¥",name:"é»ƒé€£è§£æ¯’ä¸¸",spec:"250T",price:1000,discount:"buy1get1"},{category:"ä¸­è—¥",name:"æ¶ˆç—”ä¸¸",spec:"250T",price:1000,discount:"buy1get1"},{category:"ä¸­è—¥",name:"éˆç›®ä¸¸",spec:"250T",price:1000,discount:"buy1get1"},{category:"ä¸­è—¥",name:"ç­‹éª¨æ²»ç—›ä¸¸",spec:"250T",price:1000,discount:"buy1get1"},{category:"ä¸­è—¥",name:"æ»‹è‚é¡§è…ä¸¸",spec:"250T",price:1000,discount:"buy1get1"},{category:"ä¸­è—¥",name:"å¤©ç‹å®‰è…¦ä¸¸",spec:"250T",price:1200,discount:"buy1get1"},{category:"ä¸­è—¥",name:"è†€èƒ±ç†é“ä¸¸",spec:"250T",price:1200,discount:"buy1get1"},{category:"ä¸­è—¥",name:"éŸ¿è²ç ´ç¬›ä¸¸",spec:"24T",price:180,discount:"buy1get1"},{category:"ä¸­è—¥",name:"é‡‘å¯§å—½æ•£",spec:"30g",price:300,discount:"buy1get1"},{category:"ä¸­è—¥",name:"é‡‘å¯§å—½æ•£",spec:"60g",price:400,discount:"buy1get1"}];

        // é è¨­å…¬å¸åˆ¥ï¼šæœªæ¨™ç¤ºè€…çš†è¦–ç‚ºã€Œä¸­ç¾è£½è—¥ã€
        products.forEach(p => { if (!p.company) p.company = 'ä¸­ç¾è£½è—¥'; });

        // ä¸­ç¾ç”Ÿé†«å“é …ï¼ˆä¾ä½ æä¾›çš„åƒ¹æ ¼è¡¨ç›´æ¥å¯«å…¥ï¼‰
        const biomedProducts = [
            { category: "è—¥æ°´", name: "ç…ä¹‹æ—…ç¾éœ–çœ¼è—¥æ°´", spec: "16ML", price: 150, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "ä¸­ç¾å„ªç¾éµæ²¹åˆ‡è† å›Š", spec: "6ç²’/ç›’", price: 200, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "ä¸­ç¾å„ªç¾éµæ²¹åˆ‡è† å›Š", spec: "63ç²’/ç›’", price: 1480, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "ä¸­ç¾èˆ’ç—›ä½³éŒ ", spec: "10ç²’/PTP/ç›’", price: 120, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "æ¨‚å£èˆ’B2B6ç·©é‡‹éŒ ", spec: "14ç²’/ç“¶", price: 200, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "æ¨‚å£èˆ’B2B6ç·©é‡‹éŒ ", spec: "32ç²’/ç“¶", price: 400, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "æ¥µç·»å°ç­–éŒ ", spec: "36éŒ /ç“¶", price: 500, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "æ¥µç·»å°ç­–éŒ ", spec: "90éŒ /ç“¶", price: 900, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "ä¸­ç¾èˆ’èƒƒå› éŒ ", spec: "20ç²’/PTP/ç›’", price: 120, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "ä¸­ç¾å„ªé€šæ¨‚è†œè¡£éŒ ", spec: "20ç²’/ç›’", price: 108, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "ä¸­ç¾å–œå•Ÿæ·¨å£å«éŒ ", spec: "20ç²’/ç›’", price: 120, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "æ„Ÿå†’å„ªç¶­ç”Ÿç´ è† å›Š", spec: "9ç²’/ç›’", price: 120, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "è§£ç—›å¯§è†œè¡£éŒ 400", spec: "10éŒ /æ”¯", price: 100, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "è§£ç—›å¯§è†œè¡£éŒ 600-è™•æ–¹", spec: "10éŒ /æ”¯", price: 150, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "éœå®‰èƒ½è† å›Š", spec: "10ç²’/ç›’", price: 200, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è»Ÿè†", name: "ä¸­ç¾ä¿éº—è†šè»Ÿè†(ç«ç‘°èŠ±é¦™)", spec: "85GM/æ”¯", price: 250, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è»Ÿè†", name: "æ„›æ½”è†šä¹³è†1å…¬çµ²/å…¬å…‹(ç‘å©·ç¾…)", spec: "5G/ç›’", price: 120, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è»Ÿè†", name: "æ½”èŠ™æ¨‚ä¹³è†", spec: "20G/ç›’", price: 220, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è»Ÿè†", name: "å¦¥æ¨‚è®šä¹³è†", spec: "20G/ç›’", price: 250, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è»Ÿè†", name: "æ¨‚æ–½æ¶ˆä¹³è†", spec: "6g/æ”¯", price: 200, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è—¥æ°´", name: "ä¸­ç¾å‘¼å‘¼å¤–ç”¨æ¶²(ç¶ èŒ¶)", spec: "32ML/ç›’", price: 220, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è—¥æ°´", name: "è‰¾é«®æ·¨è—¥ç”¨æ´—é«®æ¶²", spec: "150G/ç“¶", price: 400, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è—¥æ°´", name: "è†šè«¾ç—›å¤–ç”¨æ¶²", spec: "75ML/ç›’", price: 150, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è—¥æ°´", name: "é¼»èˆ’åº·å™´é¼»æ¶²", spec: "20ML/ç›’", price: 200, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è—¥æ°´", name: "ä¸­ç¾èšŠé¿é˜²èšŠæ¶²", spec: "75ML/ç›’", price: 220, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è—¥æ°´", name: "åˆ©ç”²åº·æŠ—ç”²ç™¬æ²¹åŠ‘(èŠ±é¦™)", spec: "3.5ML/ç›’", price: 1050, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è»Ÿè†", name: "ä¸­ç¾ç¾å£éº—å£å…§è†(å“ˆå¯†ç“œå‘³)", spec: "5G/ç›’", price: 160, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è—¥æ°´", name: "ä¸­ç¾å¿«æ‚ ç‚å£è…”æ¶ˆç‚å™´éœ§åŠ‘(è‘¡è„å‘³)", spec: "28ML/ç›’", price: 270, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è»Ÿè†", name: "ç¥›ç™¢è­·ä¹³è†", spec: "20G/ç›’", price: 200, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è»Ÿè†", name: "è†šç‚æ¶ˆå¾®ç´ è»Ÿè†", spec: "22G/ç›’", price: 220, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "éŒ åŠ‘", name: "ä¸­ç¾ç”Ÿé†«å‡ç‰™æ¸…æ½”éŒ (ç¶ èŒ¶)", spec: "72ç²’/ç›’", price: 280, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "å¤–è³¼", name: "ä»™åŒé€€ç†±è²¼", spec: "2ç‰‡/åŒ…(4åŒ…/ç›’)", price: 180, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è—¥æ°´", name: "L-8020ç¾å£æ½”ä¹³é…¸èŒæ¼±å£æ°´(è–„è·)", spec: "500ML", price: 299, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è»Ÿè†", name: "Teryleafç¾å£æ½”è‰æœ¬ç‰™è†", spec: "100G/ç›’", price: 280, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è—¥æ°´", name: "æ¬£ç›®ç›Šç¦é»çœ¼æ¶²-è™•æ–¹", spec: "5ml/ç“¶/ç›’", price: 150, company: "ä¸­ç¾ç”Ÿé†«" },
            { category: "è—¥æ°´", name: "ä¾¿é€šæ¨‚ç”˜æ²¹æµ£è…¸æ¶²", spec: "10ml/æ”¯(20å…¥/B)", price: 65, company: "ä¸­ç¾ç”Ÿé†«" }
        ];

        products.push(...biomedProducts);


        let cart = [];
        let currentCategory = 'all';

        document.addEventListener('DOMContentLoaded', function() {
            renderProducts();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentCategory = this.dataset.category;
                    renderProducts();
                });
            });

            document.getElementById('productSearch').addEventListener('input', function(e) {
                renderProducts(e.target.value.toLowerCase());
            });
        }

        function calculateFinalPrice(product, quantity) {
            if (product.discount === 'buy1get1') {
                const pairs = Math.floor(quantity / 2);
                const remainder = quantity % 2;
                return (pairs + remainder) * product.price;
            } else if (product.discount === 'sendon70') {
                return Math.round(product.price * quantity * 0.7);
            }
            return product.price * quantity;
        }

        function renderProducts(searchTerm = '') {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';

            let filteredProducts = products;

            // é¡åˆ¥éæ¿¾ï¼šæ–°å¢ã€Œä¸­ç¾ç”Ÿé†«ã€ç‚ºå…¬å¸åˆ¥éæ¿¾ï¼Œå…¶é¤˜é¡åˆ¥ç¶­æŒåŸé‚è¼¯ï¼ˆåƒ…é¡¯ç¤ºä¸­ç¾è£½è—¥ï¼‰
            if (currentCategory === 'ä¸­ç¾ç”Ÿé†«') {
                filteredProducts = filteredProducts.filter(p => (p.company || 'ä¸­ç¾è£½è—¥') === 'ä¸­ç¾ç”Ÿé†«');
            } else {
                // é è¨­æ‰€æœ‰é¡åˆ¥ï¼ˆåŒ…å«ã€Œå…¨éƒ¨ã€ï¼‰åƒ…é¡¯ç¤ºä¸­ç¾è£½è—¥ï¼Œé¿å…ä¸­ç¾ç”Ÿé†«æ··åœ¨åŸé¡åˆ¥ä¸­
                filteredProducts = filteredProducts.filter(p => (p.company || 'ä¸­ç¾è£½è—¥') !== 'ä¸­ç¾ç”Ÿé†«');
                if (currentCategory !== 'all') {
                    filteredProducts = filteredProducts.filter(p => p.category === currentCategory);
                }
            }

            if (searchTerm) {
                filteredProducts = filteredProducts.filter(p =>
                    p.name.toLowerCase().includes(searchTerm) ||
                    p.spec.toLowerCase().includes(searchTerm)
                );
            }

            if (filteredProducts.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-gray);">æ‰¾ä¸åˆ°ç¬¦åˆçš„ç”¢å“</div>';
                return;
            }

            filteredProducts.forEach((product) => {
                const sampleQty = 1;
                const finalPrice = calculateFinalPrice(product, sampleQty);

                const card = document.createElement('div');
                card.className = 'product-card';

                let discountBadgeHTML = '';
                let finalPriceHTML = '';

                if (product.discount === 'buy1get1') {
                    discountBadgeHTML = '<div class="discount-badge">è²·ä¸€é€ä¸€</div>';
                    finalPriceHTML = `<div class="final-price">å¯¦ä»˜ï¼šNT$ ${finalPrice}/å€‹</div>`;
                } else if (product.discount === 'sendon70') {
                    discountBadgeHTML = '<div class="discount-badge sendon">ä»™åŒ7æŠ˜</div>';
                    finalPriceHTML = `<div class="final-price">å„ªæƒ åƒ¹ï¼šNT$ ${finalPrice}</div>`;
                }

                card.innerHTML = `
                    <div class="product-name">${product.name}</div>
                    <div class="product-spec">${product.spec}</div>
                    <div class="product-price">åŸåƒ¹ NT$ ${product.price}</div>
                    ${finalPriceHTML}
                    ${discountBadgeHTML}
                `;

                card.addEventListener('click', () => addToCart(product));
                grid.appendChild(card);
            });
        }

        function addToCart(product) {
            const existingItem = cart.find(item =>
                item.name === product.name && item.spec === product.spec && (item.company || 'ä¸­ç¾è£½è—¥') === (product.company || 'ä¸­ç¾è£½è—¥')
            );

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }

            renderCart();
            showAlert('âœ“ å·²åŠ å…¥è³¼ç‰©è»Š', false);
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            renderCart();
        }

        function updateQuantity(index, delta) {
            cart[index].quantity += delta;
            if (cart[index].quantity <= 0) {
                removeFromCart(index);
            } else {
                renderCart();
            }
        }

        function renderCart() {
            const cartContent = document.getElementById('cartContent');

            if (cart.length === 0) {
                cartContent.innerHTML = `
                    <div class="cart-empty">
                        <p>ğŸ›’ è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>
                        <p style="font-size: 0.9em; margin-top: 8px;">é»æ“Šå·¦å´ç”¢å“åŠ å…¥è³¼ç‰©è»Š</p>
                    </div>
                `;
                return;
            }

            let totalOriginal = 0;
            let totalFinal = 0;

            const itemsHTML = cart.map((item, index) => {
                const itemTotal = calculateFinalPrice(item, item.quantity);
                const itemOriginal = item.price * item.quantity;
                totalOriginal += itemOriginal;
                totalFinal += itemTotal;

                const discountText = item.discount === 'buy1get1' ? 'è²·ä¸€é€ä¸€' : 'ä»™åŒ7æŠ˜';

                return `
                    <div class="cart-item">
                        <div class="cart-item-header">
                            <div class="cart-item-name">${item.name}</div>
                            <button class="cart-item-remove" onclick="removeFromCart(${index})">Ã—</button>
                        </div>
                        <div class="cart-item-details">${item.spec} | ${discountText}</div>
                        <div class="cart-item-details">å–®åƒ¹ï¼šNT$ ${item.price}</div>
                        <div class="cart-item-quantity">
                            <button class="qty-btn" onclick="updateQuantity(${index}, -1)">-</button>
                            <span class="qty-display">${item.quantity}</span>
                            <button class="qty-btn" onclick="updateQuantity(${index}, 1)">+</button>
                        </div>
                        <div class="cart-item-price">å°è¨ˆï¼šNT$ ${itemTotal}</div>
                    </div>
                `;
            }).join('');

            const discount = totalOriginal - totalFinal;

            cartContent.innerHTML = `
                <div class="cart-items">
                    ${itemsHTML}
                </div>
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>å•†å“åŸåƒ¹ï¼š</span>
                        <span>NT$ ${totalOriginal}</span>
                    </div>
                    <div class="summary-row" style="color: var(--danger);">
                        <span>å„ªæƒ æŠ˜æ‰£ï¼š</span>
                        <span>- NT$ ${discount}</span>
                    </div>
                    <div class="summary-row total">
                        <span>å¯¦ä»˜ç¸½é¡ï¼š</span>
                        <span>NT$ ${totalFinal}</span>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="submitOrder()" id="submitBtn">
                    âœ“ æäº¤è¨‚å–® (å…± ${cart.length} é …)
                </button>
                <button class="btn btn-danger" onclick="clearCart()">
                    ğŸ—‘ï¸ æ¸…ç©ºè³¼ç‰©è»Š
                </button>
            `;
        }

        function clearCart() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºè³¼ç‰©è»Šå—ï¼Ÿ')) {
                cart = [];
                renderCart();
            }
        }

        async function submitOrder() {
            const employeeName = document.getElementById('employeeName').value.trim();

            if (!employeeName) {
                showAlert('âŒ è«‹è¼¸å…¥è¨‚è³¼äººå§“å', true);
                document.getElementById('employeeName').focus();
                return;
            }

            if (cart.length === 0) {
                showAlert('âŒ è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œè«‹å…ˆé¸æ“‡ç”¢å“', true);
                return;
            }

            document.getElementById('loading').classList.add('active');
            const submitBtn = document.getElementById('submitBtn');
            if (submitBtn) submitBtn.disabled = true;

            let successCount = 0;
            let failCount = 0;

            try {
                for (const item of cart) {
                    const finalTotal = calculateFinalPrice(item, item.quantity);
                    const discountType = item.discount === 'buy1get1'
                        ? 'è²·ä¸€é€ä¸€'
                        : (item.discount === 'sendon70' ? 'ä»™åŒ7æŠ˜' : '');

                    const orderData = {
                        productName: item.name,
                        spec: item.spec,
                        unitPrice: item.price,
                        quantity: item.quantity,
                        total: finalTotal,
                        note: discountType,
                        orderer: employeeName,
                        company: item.company || 'ä¸­ç¾è£½è—¥'
                    };

                    try {
                        const response = await fetch(SCRIPT_URL, {
                            redirect: 'follow',
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            body: new URLSearchParams({
                                data: JSON.stringify(orderData)
                            })
                        });

                        if (response.ok || response.type === 'opaque') {
                            successCount++;
                        } else {
                            failCount++;
                        }
                    } catch (err) {
                        console.log('æäº¤ç”¢å“:', item.name, '- å·²ç™¼é€');
                        successCount++;
                    }

                    await new Promise(resolve => setTimeout(resolve, 800));
                }

                const totalItems = cart.length;
                const totalAmount = cart.reduce((sum, item) => sum + calculateFinalPrice(item, item.quantity), 0);

                showAlert(`âœ… è¨‚å–®æäº¤æˆåŠŸï¼\n\nå…± ${totalItems} é …ç”¢å“\nç¸½é‡‘é¡ï¼šNT$ ${totalAmount}\n\nè«‹åˆ° Google Sheet ç¢ºèªè¨‚å–®`, false);

                cart = [];
                renderCart();
                document.getElementById('employeeName').value = '';

            } catch (error) {
                console.error('æäº¤éŒ¯èª¤ï¼š', error);
                showAlert('âš ï¸ è¨‚å–®å·²æäº¤ï¼Œè«‹åˆ° Google Sheet ç¢ºèª\n\nå¦‚æœæ²’æœ‰çœ‹åˆ°è¨‚å–®ï¼Œè«‹è¯çµ¡ç®¡ç†å“¡', false);
            } finally {
                document.getElementById('loading').classList.remove('active');
                if (submitBtn) submitBtn.disabled = false;
            }
        }

        function showAlert(message, isError) {
            const alertBox = document.getElementById('alertBox');
            alertBox.textContent = message;
            alertBox.className = 'alert active' + (isError ? ' error' : '');

            setTimeout(() => {
                alertBox.classList.remove('active');
            }, 6000);
        }
    </script>
</body>
</html>
